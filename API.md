.

# API Documentation — MinIO Presign URL Service

This service generates **presigned download URLs** for objects stored in MinIO/S3 by calling the MinIO CLI (`mc`) internally.

Base URL depends on your deployment:

- **Internal (recommended in Coolify network):** `http://minio-presign-service:8080`
- **Local dev:** `http://localhost:8080`
- **Public domain (optional):** `https://presign.yourdomain.com`

---

## Authentication

All endpoints **except `/health`** require authentication.

You can authenticate using either:

### Option A — `x-api-token` header (recommended)


x-api-token: <API_TOKEN>


### Option B — Authorization bearer token


Authorization: Bearer <API_TOKEN>


If missing/incorrect, the service returns:
- **401 Unauthorized**
```json
{ "error": "unauthorized" }

Content Type

Requests with JSON bodies must include:

Content-Type: application/json

Endpoint: Health Check
GET /health

A simple health endpoint for Coolify / load balancers.

Auth required: No

Purpose: confirms the web service process is up

Side effects: none (no MinIO / mc calls)

Response

200 OK

Body (plain text):

ok

Example
curl http://localhost:8080/health

Endpoint: Generate Presigned Download URL
POST /presign

Generates a time-limited download URL for an object stored in MinIO.

Auth required: Yes

Side effects: runs an mc share download ... command internally

Request Body (JSON)
{
  "bucket": "string",
  "folder": "string (optional)",
  "key": "string",
  "days": 0,
  "hours": 0,
  "minutes": 0
}

Parameters
bucket (required)

Type: string

Description: Name of the MinIO bucket

Constraints:

Must exist (otherwise mc will fail)

Do not include s3:// or alias prefix

Example values:

"evate-payslips"

"documents"

"loan-files-archive"

folder (optional)

Type: string

Description: Object prefix / folder path inside the bucket

Notes:

May be empty or omitted

Leading/trailing / are safely ignored

Example values:

"payslips/2026/Jan"

"customers/2025/EVT0005"

"invoices"

"" (root)

key (required)

Type: string

Description: The object name or object key within the folder

Notes:

If the object is nested deeper, put the full remaining path in key

Leading/trailing / are safely ignored

Example values:

"Afroz_Sayed.pdf"

"statement_2026-01.csv"

"aadhaar_front.jpg"

"nested/subpath/file.png" (valid)

days (optional)

Type: integer

Description: Expiry duration in days

Default: 0

Valid range: >= 0

Example values: 0, 1, 7

hours (optional)

Type: integer

Description: Expiry duration in hours

Default: 0

Valid range: >= 0

Example values: 0, 2, 12

minutes (optional)

Type: integer

Description: Expiry duration in minutes

Default: 0

Valid range: >= 0

Example values: 0, 15, 30

Expiry Rules

The service converts {days, hours, minutes} into an mc expiry string like:

2d

6h

30m

2d6h30m

If all three are zero:

default expiry is 15 minutes (15m)

If any value is negative:

treated as invalid → request fails (400)

Note: Actual maximum expiry may depend on MinIO/S3 configuration and mc behavior. If mc rejects the expiry, the service returns the mc error.

How Object Path is Built

The service forms the object path as:

object = <folder>/<key>


Examples:

folder	key	resulting object
payslips/2026/Jan	Afroz_Sayed.pdf	payslips/2026/Jan/Afroz_Sayed.pdf
(omitted)	file.pdf	file.pdf
customers/EVT0005/	/aadhaar.jpg	customers/EVT0005/aadhaar.jpg
Success Response
200 OK
{
  "url": "string",
  "object": "string",
  "bucket": "string",
  "expires_in": "string"
}

Response Fields
url

Type: string

Description: The presigned download URL generated by mc

Format: http://... or https://... with query parameters

Example:

"https://minio.evatefinance.com/evate-payslips/payslips/2026/Jan/Afroz_Sayed.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=..."

object

Type: string

Description: Final resolved object key (folder + key)

Example: "payslips/2026/Jan/Afroz_Sayed.pdf"

bucket

Type: string

Description: Bucket used

Example: "evate-payslips"

expires_in

Type: string

Description: The expiry string passed to mc

Examples: "15m", "2h", "1d6h30m"

Sample Request + Sample Response
Example 1 — 2 hours expiry
Request
curl -X POST "http://localhost:8080/presign" \
  -H "Content-Type: application/json" \
  -H "x-api-token: YOUR_API_TOKEN" \
  -d '{
    "bucket": "evate-payslips",
    "folder": "payslips/2026/Jan",
    "key": "Afroz_Sayed.pdf",
    "days": 0,
    "hours": 2,
    "minutes": 0
  }'

Response (example)
{
  "url": "https://minio.evatefinance.com/evate-payslips/payslips/2026/Jan/Afroz_Sayed.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIA...%2F20260130%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20260130T061500Z&X-Amz-Expires=7200&X-Amz-SignedHeaders=host&X-Amz-Signature=9f2c...e12",
  "object": "payslips/2026/Jan/Afroz_Sayed.pdf",
  "bucket": "evate-payslips",
  "expires_in": "2h"
}


Note: URL query parameters will vary each time (signature is unique).

Error Responses (All Errors Return JSON)

All errors follow:

{ "error": "message" }

400 Bad Request — Validation / mc failure

Common causes:

missing bucket or key

object does not exist

bucket does not exist

invalid expiry string rejected by mc

Example:

{ "error": "bucket is required" }


Or a trimmed mc error, e.g.:

{ "error": "Unable to prepare URL for download. The specified key does not exist." }

401 Unauthorized — Missing/Invalid token
{ "error": "unauthorized" }

405 Method Not Allowed
{ "error": "method not allowed" }

500 Internal Server Error — Misconfiguration

Example when token isn’t configured in environment:

{ "error": "API_TOKEN is not set on server" }

504 Gateway Timeout — mc command timed out
{ "error": "mc command timed out" }

Notes for n8n Usage

Use internal URL if n8n is on same network:

http://minio-presign-service:8080/presign

Store token in n8n env var and pass as header:

x-api-token: {{$env.MINIO_PRESIGN_TOKEN}}
